env:
    APPLICATION_ENV: development-heroku

stores:
- DE

command-timeout: 3600

sections:
    generate:
        generate-transfers:
            command: "vendor/bin/console transfer:generate"

    database-migrate:
        propel-config:
            command: "vendor/bin/console propel:config:convert"
            stores:
            - DE
            groups:
            - propel

        propel-create:
            command: "vendor/bin/console propel:database:create"
            stores:
            - DE
            groups:
            - propel

        propel-postgres-compatibility:
            command: "vendor/bin/console propel:pg-sql-compat"
            stores:
            - DE
            groups:
            - propel

        propel-copy-schema:
            command: "vendor/bin/console propel:schema:copy"
            stores:
            - DE
            groups:
            - propel

        propel-build:
            command: "vendor/bin/console propel:model:build"
            groups:
            - propel

        propel-diff:
            command: "vendor/bin/console propel:diff"
            stores:
            - DE
            groups:
            - propel

        propel-migration-check:
            command: "vendor/bin/console propel:migration:check"
            breakOnFailure: false
            stores:
            - DE
            groups:
            - propel

        maintenance-page-enable:
            command: "vendor/bin/console maintenance:enable"
            stores: true
            condition:
                command: "propel-migration-check"
                ifExitCode: 2

        propel-migrate:
            command: "vendor/bin/console propel:migrate"
            stores:
            - US
            - DE
            groups:
            - propel
            timeout: 600

        maintenance-page-disable:
            command: "vendor/bin/console maintenance:disable"
            stores: true

        generate-entity-transfer:
            command: "vendor/bin/console transfer:generate"

        setup-search:
            command: "vendor/bin/console setup:search"
            stores: true
            groups:
            - elastic

    navigation-cache-warmup:
        navigation-cache-warmup:
            command: "vendor/bin/console navigation:build-cache"

    twig-cache-warmup:
        twig-cache-warmup:
            command: "vendor/bin/console twig:cache:warmer"
